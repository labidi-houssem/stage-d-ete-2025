generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String?
  name          String?
  image         String?
  emailVerified DateTime?
  role          UserRole  @default(CANDIDAT)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Additional fields from your signup form
  cin           String?   @unique
  nom           String?
  prenom        String?
  telephone     String?
  dateDelivrance DateTime?
  lieuDelivrance String?
  address       String?
  nationalite   String?
  civilite      String?
  dateNaissance DateTime?
  gouvernorat   String?
  specialite    String?

  // Relations
  disponibilites Disponibilite[] @relation("EnseignantDisponibilites")
  reservations   Reservation[]    @relation("CandidatReservations")
}

model Disponibilite {
  id            String    @id @default(cuid())
  id_Enseignant String
  dateDebut     DateTime
  dateFin       DateTime
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  enseignant    User          @relation("EnseignantDisponibilites", fields: [id_Enseignant], references: [id], onDelete: Cascade)
  reservations  Reservation[] @relation("DisponibiliteReservations")
}

model Reservation {
  id               String           @id @default(cuid())
  id_Candidat      String
  id_Disponibilite String
  status           ReservationStatus @default(EN_ATTENTE)
  result           ReservationResult @default(EN_ATTENTE)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  // Relations
  candidat         User           @relation("CandidatReservations", fields: [id_Candidat], references: [id], onDelete: Cascade)
  disponibilite    Disponibilite  @relation("DisponibiliteReservations", fields: [id_Disponibilite], references: [id], onDelete: Cascade)
}

enum UserRole {
  ADMIN
  ENSEIGNANT
  CANDIDAT
  ETUDIANT
}

enum ReservationStatus {
  EN_ATTENTE
  CONFIRMEE
  ANNULEE
  TERMINEE
}

enum ReservationResult {
  EN_ATTENTE
  ACCEPTER
  REFUSER
}
